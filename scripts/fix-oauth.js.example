#!/usr/bin/env node

// Example OAuth debugging script
// Copy this to fix-oauth.js and use your actual credentials

const { OAuth2Client } = require('google-auth-library');

console.log('ğŸ” Google OAuth ì„¤ì • ì§„ë‹¨ ì‹œì‘...\n');

// í™˜ê²½ ë³€ìˆ˜ì—ì„œ ì½ê¸° (ë˜ëŠ” ê¸°ë³¸ê°’ ì‚¬ìš©)
const CLIENT_ID = process.env.GOOGLE_CLIENT_ID || 'YOUR_CLIENT_ID_HERE';
const CLIENT_SECRET = process.env.GOOGLE_CLIENT_SECRET || 'YOUR_CLIENT_SECRET_HERE';

console.log('ğŸ“‹ í˜„ì¬ OAuth ì„¤ì •:');
console.log('-------------------');
console.log(`CLIENT_ID: ${CLIENT_ID}`);
console.log(`CLIENT_SECRET: ${CLIENT_SECRET.substring(0, 10)}...`);

// OAuth í´ë¼ì´ì–¸íŠ¸ í…ŒìŠ¤íŠ¸
async function testOAuthClient() {
  try {
    const client = new OAuth2Client(
      CLIENT_ID,
      CLIENT_SECRET,
      'https://photo-calendar.vercel.app/api/auth/callback/google'
    );
    
    const authUrl = client.generateAuthUrl({
      access_type: 'offline',
      scope: [
        'https://www.googleapis.com/auth/userinfo.profile',
        'https://www.googleapis.com/auth/userinfo.email',
        'https://www.googleapis.com/auth/calendar'
      ]
    });
    
    console.log('\nâœ… OAuth í´ë¼ì´ì–¸íŠ¸ ê°ì²´ ìƒì„± ì„±ê³µ');
    console.log('\nğŸ“ ìƒì„±ëœ ì¸ì¦ URL:');
    console.log(authUrl);
    
    // URLì—ì„œ client_id ì¶”ì¶œí•˜ì—¬ í™•ì¸
    const urlParams = new URL(authUrl).searchParams;
    const urlClientId = urlParams.get('client_id');
    
    if (urlClientId === CLIENT_ID) {
      console.log('\nâœ… Client IDê°€ URLì— ì˜¬ë°”ë¥´ê²Œ í¬í•¨ë¨');
    } else {
      console.log('\nâŒ Client ID ë¶ˆì¼ì¹˜!');
      console.log(`   ì˜ˆìƒ: ${CLIENT_ID}`);
      console.log(`   ì‹¤ì œ: ${urlClientId}`);
    }
    
  } catch (error) {
    console.log('\nâŒ OAuth í´ë¼ì´ì–¸íŠ¸ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨:', error.message);
  }
}

// ìƒˆë¡œìš´ OAuth ì„¤ì • ìƒì„± ê°€ì´ë“œ
function printSetupGuide() {
  console.log('\n\nğŸ“š Google OAuth ì„¤ì • ê°€ì´ë“œ:');
  console.log('================================\n');
  
  console.log('1. Google Cloud Console ì ‘ì†:');
  console.log('   https://console.cloud.google.com/apis/credentials\n');
  
  console.log('2. ìƒˆ OAuth 2.0 í´ë¼ì´ì–¸íŠ¸ ID ë§Œë“¤ê¸°:');
  console.log('   - "ì‚¬ìš©ì ì¸ì¦ ì •ë³´ ë§Œë“¤ê¸°" â†’ "OAuth í´ë¼ì´ì–¸íŠ¸ ID" í´ë¦­');
  console.log('   - ì• í”Œë¦¬ì¼€ì´ì…˜ ìœ í˜•: "ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜"');
  console.log('   - ì´ë¦„: "Photo Calendar Vercel"\n');
  
  console.log('3. ìŠ¹ì¸ëœ ë¦¬ë””ë ‰ì…˜ URI ì¶”ê°€:');
  console.log('   - https://photo-calendar.vercel.app/api/auth/callback/google');
  console.log('   - http://localhost:3000/api/auth/callback/google (ê°œë°œìš©)\n');
  
  console.log('4. ìƒˆë¡œìš´ Client IDì™€ Secret ë³µì‚¬\n');
  
  console.log('5. Vercelì— í™˜ê²½ ë³€ìˆ˜ ì—…ë°ì´íŠ¸:');
  console.log('   ```bash');
  console.log('   echo "ìƒˆ_CLIENT_ID" | vercel env add GOOGLE_CLIENT_ID production --force');
  console.log('   echo "ìƒˆ_CLIENT_SECRET" | vercel env add GOOGLE_CLIENT_SECRET production --force');
  console.log('   ```\n');
  
  console.log('6. ì¬ë°°í¬:');
  console.log('   ```bash');
  console.log('   vercel --prod');
  console.log('   ```');
}

// ì‹¤í–‰
testOAuthClient();
printSetupGuide();

console.log('\n\nğŸ’¡ ì¶”ê°€ ë””ë²„ê¹… ì •ë³´:');
console.log('----------------------');
console.log('NextAuth ë””ë²„ê·¸ ëª¨ë“œ í™œì„±í™”í•˜ë ¤ë©´ í™˜ê²½ ë³€ìˆ˜ ì¶”ê°€:');
console.log('NEXTAUTH_DEBUG=true');
console.log('\n401 ì˜¤ë¥˜ì˜ ì¼ë°˜ì ì¸ ì›ì¸:');
console.log('1. Client IDê°€ ì¡´ì¬í•˜ì§€ ì•Šê±°ë‚˜ ì‚­ì œë¨');
console.log('2. Client Secretì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŒ');
console.log('3. í”„ë¡œì íŠ¸ê°€ ë¹„í™œì„±í™”ë˜ê±°ë‚˜ ê²°ì œ ë¬¸ì œ');
console.log('4. OAuth ë™ì˜ í™”ë©´ì´ êµ¬ì„±ë˜ì§€ ì•ŠìŒ');
console.log('5. ë¦¬ë‹¤ì´ë ‰íŠ¸ URIê°€ ë“±ë¡ë˜ì§€ ì•ŠìŒ');